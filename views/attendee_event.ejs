<!-- attendee_event.ejs -->
<!-- Workshop detail and booking page for guests -->
<!-- Includes waitlist functionality when sold out (EXTENSION) -->
<!-- START -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title><%= event.title %> | Flavor Academy</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Open+Sans:wght@400;600&display=swap">
        <link rel="stylesheet" href="/attendee.css">
        <link rel="stylesheet" href="/main.css">
    </head>
    <body>
        
        <!-- navigation bar -->
        <nav class="navbar navbar-custom mb-4">
            <div class="container-fluid justify-content-end align-items-center" style="height: 100%;">
                <span class="navbar-brand mb-0">Flavor Academy</span>
            </div>
        </nav>
    
        <!-- back to guest portal -->
        <div class="mt-2 mb-4 home-btn-left">
            <a href="/attendee" class="btn btn-outline-light btn-sm">Back to Workshops</a>
        </div>

        <!-- flash messages -->
        <% if (typeof success !== 'undefined' && success && success.length > 0) { %>
            <div class="container">
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <%= success[0] %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        <% } %>
        <% if (typeof error !== 'undefined' && error && error.length > 0) { %>
            <div class="container">
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <%= error[0] %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        <% } %>

        <!-- workshop details -->
        <div class="container text-center mt-5">
            <h1 class="mb-3">Attendee Event Page</h1>
            <h2 class="mb-2"><%= event.title %></h2>
            <h5 class="text-info mb-3"><%= event.event_date %></h5>
            <p class="text-light mb-4" style="max-width: 600px; margin: 0 auto;"><%= event.description %></p>
        </div>

        <!-- SOLD OUT NOTICE (EXTENSION) -->
        <% if (typeof isSoldOut !== 'undefined' && isSoldOut) { %>
        <div class="container mt-4" style="max-width: 600px;">
            <div class="alert alert-warning text-center">
                <h4 class="alert-heading">Sold Out!</h4>
                <p>All seats for this workshop have been booked.</p>
                <% if (typeof waitlistCount !== 'undefined' && waitlistCount > 0) { %>
                    <p class="mb-0"><small><%= waitlistCount %> people currently on the waitlist</small></p>
                <% } %>
            </div>
        </div>

        <!-- WAITLIST FORM (EXTENSION) -->
        <div class="container mt-4" style="max-width: 600px;">
            <h3 class="text-center mb-4">Join the Waitlist</h3>
            <p class="text-center text-muted mb-4">We'll notify you by email if seats become available.</p>
            
            <form method="POST" action="/attendee/event/<%= event.event_id %>/waitlist" class="card-accent p-4 rounded shadow">
                
                <!-- guest name -->
                <div class="mb-3">
                    <label for="attendee_name" class="form-label">Your Name <span class="text-danger">*</span></label>
                    <input
                        type="text"
                        class="form-control"
                        id="attendee_name"
                        name="attendee_name"
                        placeholder="Enter your full name"
                        required
                        minlength="2"
                    >
                </div>

                <!-- guest email (required for waitlist) -->
                <div class="mb-3">
                    <label for="attendee_email" class="form-label">Email Address <span class="text-danger">*</span></label>
                    <input
                        type="email"
                        class="form-control"
                        id="attendee_email"
                        name="attendee_email"
                        placeholder="your.email@example.com"
                        required
                    >
                    <div class="form-text">Required for waitlist notification</div>
                </div>

                <!-- preferred ticket type -->
                <div class="mb-3">
                    <label for="ticket_type" class="form-label">Preferred Seat Type</label>
                    <select class="form-select" id="ticket_type" name="ticket_type">
                        <option value="full">Standard Seat</option>
                        <option value="concession">Student/Senior Seat</option>
                    </select>
                </div>

                <!-- quantity wanted -->
                <div class="mb-3">
                    <label for="quantity" class="form-label">Number of Seats Needed</label>
                    <input
                        type="number"
                        class="form-control"
                        id="quantity"
                        name="quantity"
                        min="1"
                        max="<%= typeof maxPerBooking !== 'undefined' ? maxPerBooking : 10 %>"
                        value="1"
                    >
                </div>

                <!-- submit button -->
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-warning btn-lg">Join Waitlist</button>
                </div>
            </form>
        </div>

        <% } else { %>
        <!-- REGULAR BOOKING FORM (when seats available) -->
    
        <div class="container mt-5" style="max-width: 600px;">
            <h3 class="text-center mb-4">Reserve Your Seats</h3>
            
            <form method="POST" action="/attendee/event/<%= event.event_id %>/book" class="card-accent p-4 rounded shadow">
    
                <!-- guest name -->
                <div class="mb-3">
                    <label for="attendee_name" class="form-label">Your Name <span class="text-danger">*</span></label>
                    <input
                        type="text"
                        class="form-control"
                        id="attendee_name"
                        name="attendee_name"
                        placeholder="Enter your full name"
                        required
                    >
                </div>

                <!-- guest email (extension feature) -->
                <div class="mb-3">
                    <label for="attendee_email" class="form-label">Email Address</label>
                    <input
                        type="email"
                        class="form-control"
                        id="attendee_email"
                        name="attendee_email"
                        placeholder="your.email@example.com"
                    >
                    <div class="form-text">For reservation confirmation</div>
                </div>
    
                <!-- seat selection -->
                <% tickets.forEach(ticket => { %>
                    <div class="mb-3">
                        <label class="form-label">
                            <% if (ticket.type === 'full') { %>
                                Standard Seat
                            <% } else if (ticket.type === 'concession') { %>
                                Student/Senior Seat
                            <% } else { %>
                                <%= ticket.type.charAt(0).toUpperCase() + ticket.type.slice(1) %> Seat
                            <% } %>
                            ($<%= ticket.price.toFixed(2) %>)
                            <% if (ticket.remaining > 0) { %>
                                <span class="text-success">| Available: <%= ticket.remaining %></span>
                            <% } else { %>
                                <span class="text-danger">| Sold Out</span>
                            <% } %>
                        </label>
                        <input
                            type="number"
                            name="<%= ticket.type %>_quantity"
                            class="form-control"
                            min="0"
                            max="<%= ticket.remaining %>"
                            value="0"
                            <%= ticket.remaining === 0 ? 'disabled' : '' %>
                        >
                    </div>
                <% }) %>

                <!-- dietary requirements (extension feature) -->
                <div class="mb-3">
                    <label for="dietary_notes" class="form-label">Dietary Requirements or Allergies</label>
                    <textarea
                        class="form-control"
                        id="dietary_notes"
                        name="dietary_notes"
                        rows="2"
                        placeholder="e.g. Vegetarian, nut allergy, gluten free..."
                    ></textarea>
                    <div class="form-text">Please let us know of any dietary restrictions</div>
                </div>
    
                <!-- submit button -->
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-accent btn-lg">Reserve Seats</button>
                </div>
    
            </form>
        </div>
        <% } %>

        <!-- back link -->
        <div class="container mt-4 text-center">
            <a href="/attendee" class="text-main text-decoration-none">Back to All Workshops</a>
        </div>

        <!-- footer spacing -->
        <div class="mb-5"></div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
<!-- END -->
